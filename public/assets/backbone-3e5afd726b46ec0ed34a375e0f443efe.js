!function(){var rsplit=function(t,e){for(var n,i,s,r=e.exec(t),a=new Array;null!=r;)n=r.index,i=e.lastIndex,0!=n&&(s=t.substring(0,n),a.push(t.substring(0,n)),t=t.slice(n)),a.push(r[0]),t=t.slice(r[0].length),r=e.exec(t);return""==!t&&a.push(t),a},chop=function(t){return t.substr(0,t.length-1)},extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};EJS=function(t){if(t="string"==typeof t?{view:t}:t,this.set_options(t),t.precompiled)return this.template={},this.template.process=t.precompiled,EJS.update(this.name,this),void 0;if(t.element){if("string"==typeof t.element){var e=t.element;if(t.element=document.getElementById(t.element),null==t.element)throw e+"does not exist!"}this.text=t.element.value?t.element.value:t.element.innerHTML,this.name=t.element.id,this.type="["}else if(t.url){t.url=EJS.endExt(t.url,this.extMatch),this.name=this.name?this.name:t.url;var n=t.url,i=EJS.get(this.name,this.cache);if(i)return i;if(i==EJS.INVALID_PATH)return null;try{this.text=EJS.request(n+(this.cache?"":"?"+Math.random()))}catch(s){}if(null==this.text)throw{type:"EJS",message:"There is no template at "+n}}var i=new EJS.Compiler(this.text,this.type);i.compile(t,this.name),EJS.update(this.name,this),this.template=i},EJS.prototype={render:function(t,e){t=t||{},this._extra_helpers=e;var n=new EJS.Helpers(t,e||{});return this.template.process.call(t,t,n)},update:function(element,options){return"string"==typeof element&&(element=document.getElementById(element)),null==options?(_template=this,function(t){EJS.prototype.update.call(_template,element,t)}):("string"==typeof options?(params={},params.url=options,_template=this,params.onComplete=function(request){var object=eval(request.responseText);EJS.prototype.update.call(_template,element,object)},EJS.ajax_request(params)):element.innerHTML=this.render(options),void 0)},out:function(){return this.template.out},set_options:function(t){this.type=t.type||EJS.type,this.cache=null!=t.cache?t.cache:EJS.cache,this.text=t.text||null,this.name=t.name||null,this.ext=t.ext||EJS.ext,this.extMatch=new RegExp(this.ext.replace(/\./,"."))}},EJS.endExt=function(t,e){return t?(e.lastIndex=0,t+(e.test(t)?"":this.ext)):null},EJS.Scanner=function(t,e,n){extend(this,{left_delimiter:e+"%",right_delimiter:"%"+n,double_left:e+"%%",double_right:"%%"+n,left_equal:e+"%=",left_comment:e+"%#"}),this.SplitRegexp="["==e?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:new RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)"),this.source=t,this.stag=null,this.lines=0},EJS.Scanner.to_text=function(t){return null==t||void 0===t?"":t instanceof Date?t.toDateString():t.toString?t.toString():""},EJS.Scanner.prototype={scan:function(t){if(scanline=this.scanline,regex=this.SplitRegexp,""==!this.source)for(var e=rsplit(this.source,/\n/),n=0;n<e.length;n++){var i=e[n];this.scanline(i,regex,t)}},scanline:function(t,e,n){this.lines++;for(var i=rsplit(t,e),s=0;s<i.length;s++){var r=i[s];if(null!=r)try{n(r,this)}catch(a){throw{type:"EJS.Scanner",line:this.lines}}}}},EJS.Buffer=function(t,e){this.line=new Array,this.script="",this.pre_cmd=t,this.post_cmd=e;for(var n=0;n<this.pre_cmd.length;n++)this.push(t[n])},EJS.Buffer.prototype={push:function(t){this.line.push(t)},cr:function(){this.script=this.script+this.line.join("; "),this.line=new Array,this.script=this.script+"\n"},close:function(){if(this.line.length>0){for(var t=0;t<this.post_cmd.length;t++)this.push(pre_cmd[t]);this.script=this.script+this.line.join("; "),line=null}}},EJS.Compiler=function(t,e){this.pre_cmd=["var ___ViewO = [];"],this.post_cmd=new Array,this.source=" ",null!=t&&("string"==typeof t?(t=t.replace(/\r\n/g,"\n"),t=t.replace(/\r/g,"\n"),this.source=t):t.innerHTML&&(this.source=t.innerHTML),"string"!=typeof this.source&&(this.source="")),e=e||"<";var n=">";switch(e){case"[":n="]";break;case"<":break;default:throw e+" is not a supported deliminator"}this.scanner=new EJS.Scanner(this.source,e,n),this.out=""},EJS.Compiler.prototype={compile:function(options,name){options=options||{},this.out="";var put_cmd="___ViewO.push(",insert_cmd=put_cmd,buff=new EJS.Buffer(this.pre_cmd,this.post_cmd),content="",clean=function(t){return t=t.replace(/\\/g,"\\\\"),t=t.replace(/\n/g,"\\n"),t=t.replace(/"/g,'\\"')};this.scanner.scan(function(t,e){if(null==e.stag)switch(t){case"\n":content+="\n",buff.push(put_cmd+'"'+clean(content)+'");'),buff.cr(),content="";break;case e.left_delimiter:case e.left_equal:case e.left_comment:e.stag=t,content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),content="";break;case e.double_left:content+=e.left_delimiter;break;default:content+=t}else switch(t){case e.right_delimiter:switch(e.stag){case e.left_delimiter:"\n"==content[content.length-1]?(content=chop(content),buff.push(content),buff.cr()):buff.push(content);break;case e.left_equal:buff.push(insert_cmd+"(EJS.Scanner.to_text("+content+")))")}e.stag=null,content="";break;case e.double_right:content+=e.right_delimiter;break;default:content+=t}}),content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),buff.close(),this.out=buff.script+";";var to_be_evaled="/*"+name+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";try{eval(to_be_evaled)}catch(e){if("undefined"==typeof JSLINT)throw e;JSLINT(this.out);for(var i=0;i<JSLINT.errors.length;i++){var error=JSLINT.errors[i];if("Unnecessary semicolon."!=error.reason){error.line++;var e=new Error;throw e.lineNumber=error.line,e.message=error.reason,options.view&&(e.fileName=options.view),e}}}}},EJS.config=function(t){EJS.cache=null!=t.cache?t.cache:EJS.cache,EJS.type=null!=t.type?t.type:EJS.type,EJS.ext=null!=t.ext?t.ext:EJS.ext;var e=EJS.templates_directory||{};EJS.templates_directory=e,EJS.get=function(t,n){return 0==n?null:e[t]?e[t]:null},EJS.update=function(t,n){null!=t&&(e[t]=n)},EJS.INVALID_PATH=-1},EJS.config({cache:!0,type:"<",ext:".ejs"}),EJS.Helpers=function(t,e){this._data=t,this._extras=e,extend(this,e)},EJS.Helpers.prototype={view:function(t,e,n){return n||(n=this._extras),e||(e=this._data),new EJS(t).render(e,n)},to_text:function(t,e){return null==t||void 0===t?e||"":t instanceof Date?t.toDateString():t.toString?t.toString().replace(/\n/g,"<br />").replace(/''/g,"'"):""}},EJS.newRequest=function(){for(var t=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],e=0;e<t.length;e++)try{var n=t[e]();if(null!=n)return n}catch(i){continue}},EJS.request=function(t){var e=new EJS.newRequest;e.open("GET",t,!1);try{e.send(null)}catch(n){return null}return 404==e.status||2==e.status||0==e.status&&""==e.responseText?null:e.responseText},EJS.ajax_request=function(t){t.method=t.method?t.method:"GET";var e=new EJS.newRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?t.onComplete(e):t.onComplete(e))},e.open(t.method,t.url),e.send(null)}}(),EJS.Helpers.prototype.date_tag=function(t,e){e instanceof Date||(e=new Date);for(var n=["January","February","March","April","May","June","July","August","September","October","November","December"],i=[],s=[],r=[],a=e.getFullYear(),o=e.getMonth(),l=e.getDate(),c=a-15;a+15>c;c++)i.push({value:c,text:c});for(var h=0;12>h;h++)s.push({value:h,text:n[h]});for(var u=0;31>u;u++)r.push({value:u+1,text:u+1});var p=this.select_tag(t+"[year]",a,i,{id:t+"[year]"}),d=this.select_tag(t+"[month]",o,s,{id:t+"[month]"}),f=this.select_tag(t+"[day]",l,r,{id:t+"[day]"});return p+d+f},EJS.Helpers.prototype.form_tag=function(t,e){return e=e||{},e.action=t,1==e.multipart&&(e.method="post",e.enctype="multipart/form-data"),this.start_tag_for("form",e)},EJS.Helpers.prototype.form_tag_end=function(){return this.tag_end("form")},EJS.Helpers.prototype.hidden_field_tag=function(t,e,n){return this.input_field_tag(t,e,"hidden",n)},EJS.Helpers.prototype.input_field_tag=function(t,e,n,i){return i=i||{},i.id=i.id||t,i.value=e||"",i.type=n||"text",i.name=t,this.single_tag_for("input",i)},EJS.Helpers.prototype.is_current_page=function(t){return window.location.href==t||window.location.pathname==t?!0:!1},EJS.Helpers.prototype.link_to=function(t,e,n){if(!t)var t="null";if(!n)var n={};return n.confirm&&(n.onclick=' var ret_confirm = confirm("'+n.confirm+'"); if(!ret_confirm){ return false;} ',n.confirm=null),n.href=e,this.start_tag_for("a",n)+t+this.tag_end("a")},EJS.Helpers.prototype.submit_link_to=function(t,e,n){if(!t)var t="null";if(!n)var n={};return n.onclick=n.onclick||"",n.confirm&&(n.onclick=' var ret_confirm = confirm("'+n.confirm+'"); if(!ret_confirm){ return false;} ',n.confirm=null),n.value=t,n.type="submit",n.onclick=n.onclick+(e?this.url_for(e):"")+"return false;",this.start_tag_for("input",n)},EJS.Helpers.prototype.link_to_if=function(t,e,n,i,s,r){return this.link_to_unless(0==t,e,n,i,s,r)},EJS.Helpers.prototype.link_to_unless=function(t,e,n,i,s){return i=i||{},t?s&&"function"==typeof s?s(e,n,i,s):e:this.link_to(e,n,i)},EJS.Helpers.prototype.link_to_unless_current=function(t,e,n,i){return n=n||{},this.link_to_unless(this.is_current_page(e),t,e,n,i)},EJS.Helpers.prototype.password_field_tag=function(t,e,n){return this.input_field_tag(t,e,"password",n)},EJS.Helpers.prototype.select_tag=function(t,e,n,i){i=i||{},i.id=i.id||t,i.value=e,i.name=t;var s="";s+=this.start_tag_for("select",i);for(var r=0;r<n.length;r++){var a=n[r],o={value:a.value};a.value==e&&(o.selected="selected"),s+=this.start_tag_for("option",o)+a.text+this.tag_end("option")}return s+=this.tag_end("select")},EJS.Helpers.prototype.single_tag_for=function(t,e){return this.tag(t,e,"/>")},EJS.Helpers.prototype.start_tag_for=function(t,e){return this.tag(t,e)},EJS.Helpers.prototype.submit_tag=function(t,e){return e=e||{},e.type=e.type||"submit",e.value=t||"Submit",this.single_tag_for("input",e)},EJS.Helpers.prototype.tag=function(t,e,n){if(!n)var n=">";var i=" ";for(var s in e){if(null!=e[s])var r=e[s].toString();else var r="";"Class"==s&&(s="class"),i+=-1!=r.indexOf("'")?s+'="'+r+'" ':s+"='"+r+"' "}return"<"+t+i+n},EJS.Helpers.prototype.tag_end=function(t){return"</"+t+">"},EJS.Helpers.prototype.text_area_tag=function(t,e,n){return n=n||{},n.id=n.id||t,n.name=n.name||t,e=e||"",n.size&&(n.cols=n.size.split("x")[0],n.rows=n.size.split("x")[1],delete n.size),n.cols=n.cols||50,n.rows=n.rows||4,this.start_tag_for("textarea",n)+e+this.tag_end("textarea")},EJS.Helpers.prototype.text_tag=EJS.Helpers.prototype.text_area_tag,EJS.Helpers.prototype.text_field_tag=function(t,e,n){return this.input_field_tag(t,e,"text",n)},EJS.Helpers.prototype.url_for=function(t){return'window.location="'+t+'";'},EJS.Helpers.prototype.img_tag=function(t,e,n){return n=n||{},n.src=t,n.alt=e,this.single_tag_for("img",n)},function(){var t,e=this,n=e.Backbone,i=[],s=i.push,r=i.slice,a=i.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="1.0.0";var o=e._;o||"undefined"==typeof require||(o=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var l=t.Events={on:function(t,e,n){if(!h(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!h(this,"once",t,[e,n])||!e)return this;var i=this,s=o.once(function(){i.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(t,s,n)},off:function(t,e,n){var i,s,r,a,l,c,u,p;if(!this._events||!h(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(a=t?[t]:o.keys(this._events),l=0,c=a.length;c>l;l++)if(t=a[l],r=this._events[t]){if(this._events[t]=i=[],e||n)for(u=0,p=r.length;p>u;u++)s=r[u],(e&&e!==s.callback&&e!==s.callback._callback||n&&n!==s.context)&&i.push(s);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=r.call(arguments,1);if(!h(this,"trigger",t,e))return this;var n=this._events[t],i=this._events.all;return n&&u(n,e),i&&u(i,arguments),this},stopListening:function(t,e,n){var i=this._listeners;if(!i)return this;var s=!e&&!n;"object"==typeof e&&(n=this),t&&((i={})[t._listenerId]=t);for(var r in i)i[r].off(e,n,this),s&&delete this._listeners[r];return this}},c=/\s+/,h=function(t,e,n,i){if(!n)return!0;if("object"==typeof n){for(var s in n)t[e].apply(t,[s,n[s]].concat(i));return!1}if(c.test(n)){for(var r=n.split(c),a=0,o=r.length;o>a;a++)t[e].apply(t,[r[a]].concat(i));return!1}return!0},u=function(t,e){var n,i=-1,s=t.length,r=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++i<s;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,a);return;case 3:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,a,o);return;default:for(;++i<s;)(n=t[i]).callback.apply(n.ctx,e)}},p={listenTo:"on",listenToOnce:"once"};o.each(p,function(t,e){l[e]=function(e,n,i){var s=this._listeners||(this._listeners={}),r=e._listenerId||(e._listenerId=o.uniqueId("l"));return s[r]=e,"object"==typeof n&&(i=this),e[t](n,i,this),this}}),l.bind=l.on,l.unbind=l.off,o.extend(t,l);var d=t.Model=function(t,e){var n,i=t||{};e||(e={}),this.cid=o.uniqueId("c"),this.attributes={},o.extend(this,o.pick(e,f)),e.parse&&(i=this.parse(i,e)||{}),(n=o.result(this,"defaults"))&&(i=o.defaults({},i,n)),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)},f=["url","urlRoot","collection"];o.extend(d.prototype,l,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return o.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var i,s,r,a,l,c,h,u;if(null==t)return this;if("object"==typeof t?(s=t,n=e):(s={})[t]=e,n||(n={}),!this._validate(s,n))return!1;r=n.unset,l=n.silent,a=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=o.clone(this.attributes),this.changed={}),u=this.attributes,h=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)e=s[i],o.isEqual(u[i],e)||a.push(i),o.isEqual(h[i],e)?delete this.changed[i]:this.changed[i]=e,r?delete u[i]:u[i]=e;if(!l){a.length&&(this._pending=!0);for(var p=0,d=a.length;d>p;p++)this.trigger("change:"+a[p],this,u[a[p]],n)}if(c)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,o.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,o.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!o.isEmpty(this.changed):o.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?o.clone(this.changed):!1;var e,n=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in t)o.isEqual(i[s],e=t[s])||((n||(n={}))[s]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},fetch:function(t){t=t?o.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(n&&n(e,i,t),e.trigger("sync",e,i,t),void 0):!1},P(this,t),this.sync("read",this,t)},save:function(t,e,n){var i,s,r,a=this.attributes;if(null==t||"object"==typeof t?(i=t,n=e):(i={})[t]=e,!(!i||n&&n.wait||this.set(i,n)))return!1;if(n=o.extend({validate:!0},n),!this._validate(i,n))return!1;i&&n.wait&&(this.attributes=o.extend({},a,i)),void 0===n.parse&&(n.parse=!0);var l=this,c=n.success;return n.success=function(t){l.attributes=a;var e=l.parse(t,n);return n.wait&&(e=o.extend(i||{},e)),o.isObject(e)&&!l.set(e,n)?!1:(c&&c(l,t,n),l.trigger("sync",l,t,n),void 0)},P(this,n),s=this.isNew()?"create":n.patch?"patch":"update","patch"===s&&(n.attrs=i),r=this.sync(s,this,n),i&&n.wait&&(this.attributes=a),r},destroy:function(t){t=t?o.clone(t):{};var e=this,n=t.success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(s){(t.wait||e.isNew())&&i(),n&&n(e,s,t),e.isNew()||e.trigger("sync",e,s,t)},this.isNew())return t.success(),!1;P(this,t);var s=this.sync("delete",this,t);return t.wait||i(),s},url:function(){var t=o.result(this,"urlRoot")||o.result(this.collection,"url")||R();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},o.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=o.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,o.extend(e||{},{validationError:n})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];o.each(m,function(t){d.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.attributes),o[t].apply(o,e)}});var g=t.Collection=function(t,e){e||(e={}),e.url&&(this.url=e.url),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,o.extend({silent:!0},e))},v={add:!0,remove:!0,merge:!0},_={add:!0,merge:!1,remove:!1};o.extend(g.prototype,l,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,o.defaults(e||{},_))},remove:function(t,e){t=o.isArray(t)?t.slice():[t],e||(e={});var n,i,s,r;for(n=0,i=t.length;i>n;n++)r=this.get(t[n]),r&&(delete this._byId[r.id],delete this._byId[r.cid],s=this.indexOf(r),this.models.splice(s,1),this.length--,e.silent||(e.index=s,r.trigger("remove",r,this,e)),this._removeReference(r));return this},set:function(t,e){e=o.defaults(e||{},v),e.parse&&(t=this.parse(t,e)),o.isArray(t)||(t=t?[t]:[]);var n,i,r,l,c,h=e.at,u=this.comparator&&null==h&&e.sort!==!1,p=o.isString(this.comparator)?this.comparator:null,d=[],f=[],m={};for(n=0,i=t.length;i>n;n++)(r=this._prepareModel(t[n],e))&&((l=this.get(r))?(e.remove&&(m[l.cid]=!0),e.merge&&(l.set(r.attributes,e),u&&!c&&l.hasChanged(p)&&(c=!0))):e.add&&(d.push(r),r.on("all",this._onModelEvent,this),this._byId[r.cid]=r,null!=r.id&&(this._byId[r.id]=r)));if(e.remove){for(n=0,i=this.length;i>n;++n)m[(r=this.models[n]).cid]||f.push(r);f.length&&this.remove(f,e)}if(d.length&&(u&&(c=!0),this.length+=d.length,null!=h?a.apply(this.models,[h,0].concat(d)):s.apply(this.models,d)),c&&this.sort({silent:!0}),e.silent)return this;for(n=0,i=d.length;i>n;n++)(r=d[n]).trigger("add",r,this,e);return c&&this.trigger("sort",this,e),this},reset:function(t,e){e||(e={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return e.previousModels=this.models,this._reset(),this.add(t,o.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:this.length},e)),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t.cid||t]},at:function(t){return this.models[t]},where:function(t,e){return o.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),o.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(o.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},sortedIndex:function(t,e,n){e||(e=this.comparator);var i=o.isFunction(e)?e:function(t){return t.get(e)};return o.sortedIndex(this.models,t,i,n)},pluck:function(t){return o.invoke(this.models,"get",t)},fetch:function(t){t=t?o.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var s=t.reset?"reset":"set";n[s](i,t),e&&e(n,i,t),n.trigger("sync",n,i,t)},P(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?o.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,i=e.success;return e.success=function(s){e.wait&&n.add(t,e),i&&i(t,s,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof d)return t.collection||(t.collection=this),t;e||(e={}),e.collection=this;var n=new this.model(t,e);return n._validate(t,e)?n:(this.trigger("invalid",this,t,e),!1)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,i),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];o.each(y,function(t){g.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.models),o[t].apply(o,e)}});var b=["groupBy","countBy","sortBy"];o.each(b,function(t){g.prototype[t]=function(e,n){var i=o.isFunction(e)?e:function(t){return t.get(e)};return o[t](this.models,i,n)}});var w=t.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];o.extend(w.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=o.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(o.isFunction(n)||(n=this[t[e]]),n){var i=e.match(S),s=i[1],r=i[2];n=o.bind(n,this),s+=".delegateEvents"+this.cid,""===r?this.$el.on(s,n):this.$el.on(s,r,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(t){this.options&&(t=o.extend({},o.result(this,"options"),t)),o.extend(this,o.pick(t,x)),this.options=t},_ensureElement:function(){if(this.el)this.setElement(o.result(this,"el"),!1);else{var e=o.extend({},o.result(this,"attributes"));this.id&&(e.id=o.result(this,"id")),this.className&&(e["class"]=o.result(this,"className"));var n=t.$("<"+o.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,i){var s=E[e];o.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var r={type:s,dataType:"json"};if(i.url||(r.url=o.result(n,"url")||R()),null!=i.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(r.contentType="application/json",r.data=JSON.stringify(i.attrs||n.toJSON(i))),i.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),i.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){r.type="POST",i.emulateJSON&&(r.data._method=s);var a=i.beforeSend;i.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",s),a?a.apply(this,arguments):void 0}}"GET"===r.type||i.emulateJSON||(r.processData=!1),"PATCH"!==r.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(r.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=i.xhr=t.ajax(o.extend(r,i));return n.trigger("request",n,l,i),l};var E={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var J=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,T=/(\(\?)?:\w+/g,$=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;o.extend(J.prototype,l,{initialize:function(){},route:function(e,n,i){o.isRegExp(e)||(e=this._routeToRegExp(e)),o.isFunction(n)&&(i=n,n=""),i||(i=this[n]);var s=this;return t.history.route(e,function(r){var a=s._extractParameters(e,r);i&&i.apply(s,a),s.trigger.apply(s,["route:"+n].concat(a)),s.trigger("route",n,a),t.history.trigger("route",s,n,a)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=o.result(this,"routes");for(var t,e=o.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(C,"\\$&").replace(k,"(?:$1)?").replace(T,function(t,e){return e?t:"([^/]+)"}).replace($,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return o.map(n,function(t){return t?decodeURIComponent(t):null})}});var H=t.History=function(){this.handlers=[],o.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,N=/msie [\w.]+/,A=/\/$/;H.started=!1,o.extend(H.prototype,l,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(A,"");t.indexOf(n)||(t=t.substr(n.length))}else t=this.getHash();return t.replace(M,"")},start:function(e){if(H.started)throw new Error("Backbone.history has already been started");H.started=!0,this.options=o.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),i=document.documentMode,s=N.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);this.root=("/"+this.root+"/").replace(j,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var r=this.location,a=r.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&r.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+r.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),H.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,e){if(!H.started)return!1;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var n=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}e.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),t.history=new H;var I=function(t,e){var n,i=this;n=t&&o.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},o.extend(n,i,e);var s=function(){this.constructor=n};return s.prototype=i.prototype,n.prototype=new s,t&&o.extend(n.prototype,t),n.__super__=i.prototype,n};d.extend=g.extend=J.extend=w.extend=H.extend=I;var R=function(){throw new Error('A "url" property or function must be specified')},P=function(t,e){var n=e.error;e.error=function(i){n&&n(t,i,e),t.trigger("error",t,i,e)}}}.call(this);var app=app||{models:{},views:{},collections:{}};app.Router=Backbone.Router.extend({routes:{"campaigns/:id":"callShow",mycampaigns:"myCampaigns"},callShow:function(t){var e=new app.models.Campaign({campaign_id:t});e.url="/campaigns/"+t+"/get_token",e.fetch({success:function(t){var e=new app.views.CallView({model:t.attributes});$("#call-campaign-show").html(e.render().el)}})},myCampaigns:function(){$("body").addClass("white-background");var t=new app.collections.MyRecordingsList;t.fetch({success:function(t){t.forEach(function(t){var e=new app.views.CampaignChartView({model:t});e.render()})}})}}),app.models.Call=Backbone.Model.extend({url:function(){var t="/campaigns/"+this.attributes.campaign_id+"/calls";return this.isNew()||(t+="/"+this.id),t},parse:function(t){return t.caller_id}}),app.models.Campaign=Backbone.Model.extend({url:function(){return"/campaigns/"+this.attributes.campaign_id+"/get_info"},initialize:function(){this.calls=new app.collections.CallList,this.calls.url="/campaigns/"+this.attributes.campaign_id+"/calls",this.calls.on("reset",this.updateCounts)}}),app.models.MyRecording=Backbone.Model.extend({url:function(){return"/users/my_recording"},initialize:function(){}}),app.models.UserSession=Backbone.Model.extend({url:function(){return"/users/is_logged_in"},initialize:function(){}}),app.collections.CallList=Backbone.Collection.extend({model:app.models.Call}),app.collections.CampaignList=Backbone.Collection.extend({model:app.models.Campaign}),app.collections.MyRecordingsList=Backbone.Collection.extend({model:app.models.MyRecording,url:"/users/my_recordings_list"}),function(){this.JST||(this.JST={}),this.JST["templates/call"]=function(obj){var __p=[];with(obj||{})__p.push('<button class="small-6 large-centered columns" id="call">\n  Call ',target_name,'\n</button>\n<button class="small-6 large-centered columns" id="hangup">\n  Hangup\n</button>\n<a href ="#" id="phone-instead" onClick="return false">Want to call with your phone instead?</a>\n<input type="text" name="phone_number" id="phone-field" placeholder="3105551305" autofocus/> \n<div id="log">Loading call...</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/next_steps"]=function(obj){var __p=[];with(obj||{})__p.push('<h2>Thank you for calling,</h2>\n<h4>but this campaigns still needs you.</h4> \n<div id="fb-share-text">Please share this page on Facebook to spread the word.</div>\n<a href= "#" id="fb-share">\n  <img src="/assets/facebook_share_button.png" />\n</a>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/recording"]=function(obj){var __p=[];with(obj||{})__p.push('<a href="#" class="play-button"><h1>Play Recording</h1></a>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/validation"]=function(obj){var __p=[];with(obj||{})__p.push("<h2>Step 1</h2>\n<h4>Calling ",phone_number," for validation</h4>\n<h4>Your validation code is</h4>\n<h1>",validation_code,'</h1>\n<a class="close-reveal-modal">&#215;</a>\n');return __p.join("")}}.call(this),app.views.CallView=Backbone.View.extend({tagName:"div",id:"call-box",template:JST["templates/call"],events:{"click a#phone-instead":"showPhone","click button#hangup":"hangup","click button#call":"call"},render:function(){var t=this.template({target_name:this.model.target_name});
return this.$el.html(t),Twilio.Device.setup(this.model.token,{debug:!0}),Twilio.Device.ready(function(){$("#log").html("<p>Press the 'Call' button above to start your phone call</p>")}),Twilio.Device.error(function(t){$("#log").html("<p>Error:  "+t.message+"</p>")}),Twilio.Device.connect(function(){$("#log").html("<p>Successfully established call</p>")}),Twilio.Device.disconnect(function(){$("#log").html("<p>Call ended</p>")}),Twilio.Device.incoming(function(t){$("#log").text("Incoming connection from "+t.parameters.From),t.accept()}),this},showPhone:function(){$("input#phone-field").toggle(),"none"==$("input#phone-field").css("display")?$("#log").html("<p>Press the 'Call' button above to start your phone call</p>"):$("#log").html("<p>Type your phone number above and hit the call button. We'll connect you!</p>")},call:function(){var t=$("input#phone-field").val(),e=$(".campaign-show-page").data("campaignid"),n=new app.models.Call({campaign_id:e}),i=new app.models.UserSession;i.fetch({success:function(i){0===i.id?$("#sign-in-modal").foundation("reveal","open"):(mixpanel.track("Call made"),""===t?(callInfo={campaign_id:e,user_id:i.id},Twilio.Device.connect(callInfo),$("button#call").toggle(),$("button#hangup").css("display","block")):n.save({phone_number:t},{success:function(t){$("#log").html("<p>Calling your phone now...</p>");var e=new app.views.ValidationView({validation_code:t.attributes.validation_code,phone_number:t.attributes.phone_number});$("#validation").html(e.render().el),$("#validation").foundation("reveal","open")}})),$("object#__connectionFlash__").parent("div").css("width","231px"),$("object#__connectionFlash__").css("z-index","999999"),$("object#__connectionFlash__").siblings("button").css({display:"block",margin:"0 auto .5em auto"})}})},hangup:function(){Twilio.Device.disconnectAll(),$("button#hangup").toggle(),$("button#call").toggle();var t=new app.views.NextStepsView;$("#next-steps").html(t.render().el),$("#next-steps").foundation("reveal","open")}}),app.views.CampaignChartView=Backbone.View.extend({render:function(){var t=moment().format("MMM-Do"),e=moment().subtract("days",1).format("MMM-Do"),n=moment().subtract("days",2).format("MMM-Do"),i=moment().subtract("days",3).format("MMM-Do"),s=moment().subtract("days",4).format("MMM-Do"),r=moment().subtract("days",5).format("MMM-Do");new Morris.Line({element:"call-chart-"+String(this.model.attributes.id),data:[{year:r,value:this.model.attributes.five_days_calls},{year:s,value:this.model.attributes.four_days_calls},{year:i,value:this.model.attributes.three_days_calls},{year:n,value:this.model.attributes.two_days_calls},{year:e,value:this.model.attributes.one_day_calls},{year:t,value:this.model.attributes.today_calls}],xkey:"year",ykeys:["value"],labels:["Calls"],parseTime:!1})}}),app.views.CampaignView=Backbone.View.extend({tagName:"div",id:"call-box",template:JST["templates/call"],events:{},render:function(){var t=this.template();return this.$el.html(t),this}}),app.views.CampaignsView=Backbone.View.extend({tagName:"div",id:"recordingButton",template:JST["templates/recording"],events:{"click .play-button":"playRecording"},render:function(){var t=this.template();return this.$el.html(t),soundManager.setup({url:"/swf/",flashVersion:9,onready:function(){soundManager.createSound({id:"showRecording",url:"http://api.twilio.com/2010-04-01/Accounts/AC3ecb799e792404580fe5e903b88d3929/Recordings/RE9e59cc8cef36ae5cf651a5582dac9306",autoLoad:!0,autoPlay:!1,onload:function(){alert("The sound recording loaded!")},whileplaying:function(){},volume:50})}}),this},playRecording:function(){soundManager.play("showRecording")}}),app.views.NextStepsView=Backbone.View.extend({tagName:"div",id:"hello",template:JST["templates/next_steps"],events:{"click #fb-share":"share"},render:function(){var t="https://www.facebook.com/sharer/sharer.php?u=",e=t+String(location.href),n=this.template({currentURL:e});return this.$el.html(n),this},share:function(){var t="https://www.facebook.com/sharer/sharer.php?u=",e=t+String(location.href);window.open(e,"sharer","width=626,height=436")}}),app.views.ValidationView=Backbone.View.extend({tagName:"div",id:"verification",validationTemplate:JST["templates/validation"],events:{},render:function(){var t=this.validationTemplate({validation_code:this.options.validation_code,phone_number:this.options.phone_number});return this.$el.html(t),this}}),$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}}),new app.Router,Backbone.history.start({pushState:!0})}),alert("ehllo");